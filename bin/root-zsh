#!/opt/bin/perl

use strict;
use warnings;

use Expect;

my $exp = new Expect;
$exp->slave->clone_winsize_from(\*STDIN);
$exp->spawn(@ARGV) or die "Cannot spawn $ARGV[0]: $!\n";
$exp->stty('-echo');

$exp->expect(
  3,
  [ qr/root]#|\$/ => sub {
      my $exp = shift;
      $exp->send("/home/aspiers/bin/zsh\n");
      my_interact($exp);
    } ],
  [ timeout => sub { my_interact(shift) } ],
  [ eof     => sub { my_interact(shift) } ],
);

sub my_interact {
  shift->interact(
#     \*STDIN,
#     'root]#',
  );
#   $exp->send("exit\n");
}

