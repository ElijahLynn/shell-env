#!/bin/sh

set -e
me=`basename $0`

if [ "$1" = '--dry-run' ] || [ "$1" = '-n' ]; then
  dry_run=--dry-run
  shift
fi

if [ $# != 2 ]; then
  echo "Usage: $me [--dry-run|-n] <src dir> <dest dir>" >&2
  exit 1
fi

if ! which cp-merge 2>&1 >/dev/null; then
  echo "cp-merge must be on \$PATH for $me to work." >&2
  exit 1
fi

oldpwd=`pwd`

cp-merge $dry_run "$@"

cd "$oldpwd"

if [ -n "$dry_run" ]; then
    cat <<EOF
Now do:

rm-src-dups $*
EOF
else
    echo rm-src-dups "$@"
    rm-src-dups "$@"
fi

