#!/bin/sh
#
# Adam's shared environment startup file
#
# $Id$
#
# This should get run as part of setting up the environment
# of any sh-compatible shell, including non-interactive ones;
# hence it should be kept as fast and as portable as possible.
# Note that that means silly things like [ ! -e foo ] rather
# than ! [ -e foo ] ...

# Allow disabling of entire environment suite
[ -n "$INHERIT_ENV" ] && return 0

# {{{ Are we interactive?

case "$-" in
  *i*) shell_interactive=y ;;
    *) shell_interactive=  ;;
esac

# }}}

# {{{ Loading status

sh_load_status () {
  # \e[0K is clear to right
  [ -n "$shell_interactive" ] && \
    echo -e -n "\r${shell:-${0##*/}} load: $* ... \e[0K"
    #echo -e "\r${shell:-${0##*/}} load: $* ... \e[0K"
}

# }}}

sh_load_status .shared_env

# {{{ zdotdir

# See .zshenv

zdotdir=${ZDOTDIR:-$HOME}
export ZDOTDIR="$zdotdir"
if [ "$ZDOTDIR" != "$HOME" ]; then
  export OTHER_USER=1
fi

# }}}

# {{{ HOST / HOSTNAME

: ${HOST:=${HOSTNAME:-`hostname`}}
: ${HOSTNAME:=$HOST}
export HOST HOSTNAME

# }}}
# {{{ HOME

# Don't leave history files in /
: ${HOME:=/}
if [ "$HOME" = '/' ]; then
  if [ -d /root ]; then
    HOME=/root
  elif [ -d /var/tmp ]; then
    new_home=/var/tmp/root.tmphome
    if [ -d "$new_home" ] || mkdir "$new_home"; then
      HOME="$new_home"
    fi
  fi
fi
[ "$HOME" = '/' ] && echo "Warning: ~ is /"

# }}}
# {{{ PATH

# Don't trust system-wide PATH?  Remember what it was, for reference.
syspath=$HOME/.syspath.$HOST
if ! [ -e $syspath ]; then
    # Ignore failed write as home directory is sometimes locked down
    # cross-WAN.
    echo "$PATH" 2>/dev/null > "$syspath" 
fi
PATH=/usr/local/bin:/usr/X11R6/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin

# ... or *do* trust system-wide PATH
#PATH=/usr/local/bin:/usr/X11R6/bin:/usr/local/sbin:/usr/sbin:/sbin:$PATH

newpaths=
for newpath in                       \
               ~/bin/{shortcuts,awk} \
               ~/sbin                \
               ~/bin                 \
               ~/local/$OSTYPE/bin   \
               ~/local/sbin          \
               ~/local/bin           \
; do
  [ -d $newpath ] && newpaths=$newpath:$newpaths
done

PATH=$newpaths:$PATH

# }}}
# {{{ MANPATH

# In order to avoid forks here, this is done in .zshrc

# }}}
# {{{ grep

# Why would you ever want grep to treat dirs like normal files?
export GREP_OPTIONS='--directories=skip'

# }}}
# {{{ GNU screen

case "$TERM" in
  screen*) IN_SCREEN=yes ; export IN_SCREEN ;;
esac

export SCREENRC=$ZDOTDIR/.screenrc

# }}}
# {{{ INPUTRC

# no crappy RedHat inputrcs, thankyouverymuch.  Which fucking *idiot*
# set convert-meta to off?
[ -n "$INPUTRC" ] && unset INPUTRC

# }}}
# {{{ COLUMNS

# Some programs might find this handy.  Shouldn't do any harm.

export COLUMNS

# }}}
# {{{ OSTYPE

# Can come in handy too, if the shell sets it (bash and zsh do).
export OSTYPE

# }}}
# {{{ IRC

export IRCNAME='Adam Spiers'
export IRCNICK='roink'
#export IRCNICK='Adam'

# }}}
# {{{ Editor

# Not sure which of these is right.
#export EDITOR=emacs
export EDITOR=fe

export VISUAL=fe

# }}}
# {{{ WWW home

export WWW_HOME='http://adamspiers.org/'

# }}}
# {{{ Pager

export METAMAIL_PAGER='less -r'
export PERLDOC_PAGER='less -r'
export PAGER='less'
export LESS='-h100 -i -j1 -M -q -y100'
export LESSOPEN="|$ZDOTDIR/bin/lesspipe.sh %s"
#export LESSCLOSE='/usr/local/bin/lessclose.sh %s %s'

# }}}
# {{{ Name and Reply_To

export NAME='Adam Spiers'
export EMAIL="Adam Spiers <darcs@adamspiers.org>" # for darcs
export REPLYTO='adam@spiers.net (Adam Spiers)'

# }}}
# {{{ POSIXLY_CORRECT for patch

#export POSIXLY_CORRECT=yes

# }}}
# {{{ Palm Pilot

export PILOTRATE=115200

# for old devices, assuming a symlink to /dev/ttyS0 or /dev/ttyUSB1 or similar
#export PILOTPORT=/dev/pilot

# for newer devices, requires newer pilot-link linked to libpisock
# (build with --enable-libusb)
export PILOTPORT=usb:

# }}}
# {{{ rsync uses ssh

export RSYNC_RSH=ssh

# }}}
# {{{ cvs uses ssh

export CVS_RSH=ssh

# }}}
# {{{ Commonly used directories

# Have cdable_vars set in zsh, so don't need 'hash -d' in front of these
# and can be reused from any shell

# Notice that it's worth setting these even if they don't exist on the
# machine they're being set on, as they could still come in handy when
# constructing scp/rsync command-lines etc.

RP=/usr/src/redhat/RPMS
I3=$RP/i386
I4=$RP/i486
I5=$RP/i586
I6=$RP/i686
NA=$RP/noarch
SR=/usr/src/redhat/SRPMS
SP=/usr/src/redhat/SPECS
SO=/usr/src/redhat/SOURCES
BU=/usr/src/redhat/BUILD
LI=/usr/src/linux
L4=/usr/src/linux-2.4
CV=/usr/local/cvsroot
RC=/etc/rc.d/init.d
VL=/var/log
VLH=$VL/httpd
SC=/etc/sysconfig
NS=/etc/sysconfig/network-scripts
# in zsh:
#hash -df

# }}}

# {{{ Specific to local setups

. $ZDOTDIR/.zsh/functions/run_local_hooks .shared_env

# }}}

